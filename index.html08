<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø³Ø§Ù…Ø§Ù†Ù‡ Ù‡ÙˆØ§Ø´Ù†Ø§Ø³ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css" rel="stylesheet">
    <style>
        :root { --p: #3b82f6; --s: #8b5cf6; --bg-d: #f8fafc; --bg-n: #0f172a; }
        * { box-sizing: border-box; outline: none; }
        body { font-family: 'Vazirmatn', sans-serif; margin: 0; height: 100vh; display: flex; flex-direction: column; overflow: hidden; transition: 0.5s; }
        body.day-mode { background: var(--bg-d); color: #1e293b; }
        body.night-mode { background: var(--bg-n); color: #f8fafc; }

        header { width: 100%; padding: 15px 5%; display: flex; justify-content: space-between; align-items: center; background: rgba(128,128,128,0.1); backdrop-filter: blur(15px); border-bottom: 1px solid rgba(128,128,128,0.2); z-index: 1000; }
        .scroll-v { flex: 1; overflow-y: auto; padding: 20px; scroll-behavior: smooth; }

        #login-overlay { position: fixed; inset: 0; z-index: 9999; background: linear-gradient(135deg, #1e3a8a, #3b82f6); display: flex; align-items: center; justify-content: center; }
        .login-card { background: white; padding: 40px; border-radius: 30px; width: 90%; max-width: 400px; text-align: center; box-shadow: 0 25px 50px rgba(0,0,0,0.3); }

        .glass { background: rgba(255,255,255,0.8); border-radius: 25px; padding: 25px; margin-bottom: 20px; box-shadow: 0 8px 32px rgba(0,0,0,0.05); border: 1px solid rgba(255,255,255,0.2); }
        .night-mode .glass { background: rgba(30, 41, 59, 0.7); border-color: rgba(255,255,255,0.05); }

        .temp-row { direction: ltr; font-size: 5rem; font-weight: 900; color: var(--p); }
        input, select, textarea { width: 100%; padding: 12px; margin: 10px 0; border-radius: 12px; border: 1px solid #ddd; font-family: inherit; }
        .btn { background: var(--p); color: white; border: none; padding: 14px; border-radius: 12px; cursor: pointer; font-weight: bold; width: 100%; transition: 0.3s; }
        .btn:hover { opacity: 0.9; transform: translateY(-2px); }
        .btn-red { background: #ef4444; width: auto; padding: 8px 15px; font-size: 0.9rem; }

        .f-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(110px, 1fr)); gap: 12px; margin-top: 20px; }
        .f-card { background: rgba(59,130,246,0.08); padding: 15px; border-radius: 20px; text-align: center; border: 1px solid rgba(59,130,246,0.1); }
        .unit { font-size: 0.8rem; opacity: 0.8; margin-right: 3px; }
        .ai-box { border-right: 6px solid var(--s); background: rgba(139, 92, 246, 0.05) !important; }
    </style>
</head>
<body class="day-mode">

<div id="login-overlay">
    <div class="login-card">
        <h2 style="color:var(--p); margin-bottom:10px">Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯</h2>
        <p style="color:#666">Ù„Ø·ÙØ§Ù‹ Ø¨Ø±Ø§ÛŒ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ù¾Ù†Ù„ Ù†Ø§Ù… Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯</p>
        <input type="text" id="fn" placeholder="Ù†Ø§Ù…">
        <input type="text" id="ln" placeholder="Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ">
        <button class="btn" onclick="login()">ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø³Ø§Ù…Ø§Ù†Ù‡</button>
    </div>
</div>

<header id="h-ui" style="display:none">
    <div style="display:flex; align-items:center; gap:15px">
        <button class="btn btn-red" onclick="logout()"><i class="fa fa-power-off"></i> Ø®Ø±ÙˆØ¬</button>
        <span id="u-display" style="background:var(--p); color:white; padding:6px 15px; border-radius:20px; font-size:0.9rem"></span>
    </div>
    <div style="text-align:center">
        <div id="clock" style="font-weight:900; color:var(--p); font-size:1.4rem; letter-spacing:1px">Û°Û°:Û°Û°:Û°Û°</div>
        <small id="date-fa" style="opacity:0.7"></small>
    </div>
    <div id="m-icon" style="font-size:1.5rem">â˜€ï¸</div>
</header>

<div class="scroll-v" id="main-ui" style="display:none">
    <div style="max-width: 800px; margin: 0 auto;">
        
        <div class="glass">
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px">
                <select id="p-sel" onchange="loadC()"><option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ø§Ø³ØªØ§Ù†...</option></select>
                <select id="c-sel" onchange="fetchData()"><option>Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ù‡Ø±...</option></select>
            </div>
        </div>

        <div id="weather-data" style="display:none">
            <div class="glass" style="text-align:center">
                <h1 id="r-city" style="margin:0; font-size:2.2rem; color:var(--p)"></h1>
                <div id="r-icon"></div>
                <div class="temp-row"><span id="r-temp"></span><span style="font-size:2rem">Â°C</span></div>
                <p id="r-desc" style="font-size:1.3rem; font-weight:bold; margin:10px 0"></p>
                
                <div style="display:grid; grid-template-columns:repeat(2, 1fr); gap:12px; margin-top:20px">
                    <div class="f-card">Ø³Ø±Ø¹Øª Ø¨Ø§Ø¯: <b id="v-w"></b><span class="unit">km/h</span></div>
                    <div class="f-card">Ø±Ø·ÙˆØ¨Øª: <b id="v-h"></b><span class="unit">%</span></div>
                    <div class="f-card">ÙØ´Ø§Ø± Ù‡ÙˆØ§: <b id="v-p"></b><span class="unit">hPa</span></div>
                    <div class="f-card">Ø¯ÛŒØ¯ Ø§ÙÙ‚ÛŒ: <b id="v-v"></b><span class="unit">km</span></div>
                </div>
            </div>

            <div class="glass ai-box">
                <h3 style="color:var(--s); margin-top:0"><i class="fa fa-robot"></i> ØªØ­Ù„ÛŒÙ„ Ù‡ÙˆØ´Ù…Ù†Ø¯ ÙˆØ¶Ø¹ÛŒØª:</h3>
                <p id="ai-msg" style="line-height:1.8; text-align:justify; margin-bottom:0"></p>
            </div>

            <div class="glass">
                <h3 style="margin-top:0">Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ Ø±ÙˆØ²Ù‡Ø§ÛŒ Ø¢ÛŒÙ†Ø¯Ù‡</h3>
                <div class="f-grid" id="f-grid"></div>
            </div>
        </div>

        <div class="glass">
            <h4 style="margin-top:0">Ø«Ø¨Øª Ú¯Ø²Ø§Ø±Ø´ Ù…Ø­Ù„ÛŒ ÛŒØ§ Ù†Ø¸Ø±</h4>
            <textarea id="c-input" rows="3" placeholder="ÙˆØ¶Ø¹ÛŒØª ÙØ¹Ù„ÛŒ Ù…Ù†Ø·Ù‚Ù‡ Ø®ÙˆØ¯ Ø±Ø§ Ú¯Ø²Ø§Ø±Ø´ Ú©Ù†ÛŒØ¯..."></textarea>
            <button class="btn" onclick="saveC()">Ø«Ø¨Øª Ø¯Ø± Ø³ÛŒØ³ØªÙ…</button>
            <div id="c-list" style="margin-top:20px"></div>
        </div>

        <p style="text-align:center; opacity:0.5; font-size:0.8rem; padding:20px">Ø·Ø±Ø§Ø­ÛŒ Ùˆ ØªÙˆØ³Ø¹Ù‡: Ø§Ø¨ÙˆØ§Ù„ÙØ¶Ù„ Ø´Ø§Ù‡Ù…ÛŒØ±Ø²Ø§ÛŒÛŒ</p>
    </div>
</div>

<script>
    const API = 'bf8755006c2fc6e2762533c174860bf6';
    const toFa = n => n.toString().replace(/\d/g, x => ['Û°','Û±','Û²','Û³','Û´','Ûµ','Û¶','Û·','Û¸','Û¹'][x]);

    // Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ø§Ø³ØªØ§Ù†â€ŒÙ‡Ø§ (Ù†Ù…ÙˆÙ†Ù‡ Ú©ÙˆØªØ§Ù‡ Ø´Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ø®ÙˆØ§Ù†Ø§ÛŒÛŒ - Ø´Ù…Ø§ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ù„ÛŒØ³Øª Ù‚Ø¨Ù„ÛŒ Ø±Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ù‚Ø±Ø§Ø± Ø¯Ù‡ÛŒØ¯)
    const DB_FULL = {
        "ØªÙ‡Ø±Ø§Ù†": ["ØªÙ‡Ø±Ø§Ù†", "Ø´Ù‡Ø±ÛŒØ§Ø±", "Ø§Ø³Ù„Ø§Ù…Ø´Ù‡Ø±", "ÙˆØ±Ø§Ù…ÛŒÙ†", "Ù…Ù„Ø§Ø±Ø¯", "Ù‚Ø¯Ø³", "Ù¾Ø§Ú©Ø¯Ø´Øª", "Ø±ÛŒ", "Ù‚Ø±Ú†Ú©", "Ù¾Ø±Ø¯ÛŒØ³", "Ø¨ÙˆÙ…Ù‡Ù†", "Ø¯Ù…Ø§ÙˆÙ†Ø¯", "Ø±Ø¨Ø§Ø·â€ŒÚ©Ø±ÛŒÙ…"],
        "Ø§ØµÙÙ‡Ø§Ù†": ["Ø§ØµÙÙ‡Ø§Ù†", "Ú©Ø§Ø´Ø§Ù†", "Ø®Ù…ÛŒÙ†ÛŒâ€ŒØ´Ù‡Ø±", "Ù†Ø¬Ùâ€ŒØ¢Ø¨Ø§Ø¯", "Ø´Ø§Ù‡ÛŒÙ†â€ŒØ´Ù‡Ø±", "Ø´Ù‡Ø±Ø¶Ø§", "Ù…Ø¨Ø§Ø±Ú©Ù‡", "Ø²Ø±ÛŒÙ†â€ŒØ´Ù‡Ø±", "Ú¯Ù„Ù¾Ø§ÛŒÚ¯Ø§Ù†"],
        "Ø®Ø±Ø§Ø³Ø§Ù† Ø±Ø¶ÙˆÛŒ": ["Ù…Ø´Ù‡Ø¯", "Ù†ÛŒØ´Ø§Ø¨ÙˆØ±", "Ø³Ø¨Ø²ÙˆØ§Ø±", "ØªØ±Ø¨Øª Ø­ÛŒØ¯Ø±ÛŒÙ‡", "Ù‚ÙˆÚ†Ø§Ù†", "Ú©Ø§Ø´Ù…Ø±", "Ú†Ù†Ø§Ø±Ø§Ù†"],
        "ÙØ§Ø±Ø³": ["Ø´ÛŒØ±Ø§Ø²", "Ù…Ø±ÙˆØ¯Ø´Øª", "Ø¬Ù‡Ø±Ù…", "ÙØ³Ø§", "Ú©Ø§Ø²Ø±ÙˆÙ†", "Ø¯Ø§Ø±Ø§Ø¨", "Ù„Ø§Ø±"],
        "Ø¢Ø°Ø±Ø¨Ø§ÛŒØ¬Ø§Ù† Ø´Ø±Ù‚ÛŒ": ["ØªØ¨Ø±ÛŒØ²", "Ù…Ø±Ø§ØºÙ‡", "Ù…Ø±Ù†Ø¯", "Ù…ÛŒØ§Ù†Ù‡", "Ø§Ù‡Ø±", "Ø¨Ù†Ø§Ø¨"],
        "Ø§Ù„Ø¨Ø±Ø²": ["Ú©Ø±Ø¬", "ÙØ±Ø¯ÛŒØ³", "Ú©Ù…Ø§Ù„â€ŒØ´Ù‡Ø±", "Ù†Ø¸Ø±Ø¢Ø¨Ø§Ø¯", "Ù…Ø­Ù…Ø¯Ø´Ù‡Ø±", "Ù…Ø§Ù‡Ø¯Ø´Øª", "Ù‡Ø´ØªÚ¯Ø±Ø¯"],
        "Ù…Ø§Ø²Ù†Ø¯Ø±Ø§Ù†": ["Ø³Ø§Ø±ÛŒ", "Ø¨Ø§Ø¨Ù„", "Ø¢Ù…Ù„", "Ù‚Ø§Ø¦Ù…â€ŒØ´Ù‡Ø±", "Ø¨Ù‡Ø´Ù‡Ø±", "Ú†Ø§Ù„ÙˆØ³", "Ù†ÙˆØ´Ù‡Ø±"]
        // Ø³Ø§ÛŒØ± Ø§Ø³ØªØ§Ù†â€ŒÙ‡Ø§ Ø±Ø§ Ø·Ø¨Ù‚ Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ù‚Ø¨Ù„ÛŒ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯...
    };

    function login() {
        const f = document.getElementById('fn').value.trim();
        const l = document.getElementById('ln').value.trim();
        if(f && l) { 
            localStorage.setItem('ab_name', f + ' ' + l); 
            location.reload(); 
        } else {
            alert("Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯");
        }
    }
    
    function logout() { localStorage.removeItem('ab_name'); location.reload(); }

    function loadC() {
        const p = document.getElementById('p-sel').value;
        const cS = document.getElementById('c-sel');
        cS.innerHTML = '<option>Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ù‡Ø±...</option>';
        if(DB_FULL[p]) DB_FULL[p].sort().forEach(c => cS.add(new Option(c, c)));
    }

    async function fetchData() {
        const city = document.getElementById('c-sel').value;
        if(!city || city.includes('Ø§Ù†ØªØ®Ø§Ø¨')) return;
        
        try {
            const r1 = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${city},IR&appid=${API}&units=metric&lang=fa`);
            const r2 = await fetch(`https://api.openweathermap.org/data/2.5/forecast?q=${city},IR&appid=${API}&units=metric&lang=fa`);
            
            if (!r1.ok) throw new Error();
            updateUI(await r1.json(), await r2.json(), city);
        } catch(e) { 
            alert("Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª. Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯."); 
        }
    }

    function updateUI(d, f, city) {
        document.getElementById('weather-data').style.display = 'block';
        document.getElementById('r-city').innerText = city;
        let t = Math.round(d.main.temp);
        document.getElementById('r-temp').innerText = toFa(t);
        document.getElementById('r-desc').innerText = d.weather[0].description;
        document.getElementById('r-icon').innerHTML = `<img src="https://openweathermap.org/img/wn/${d.weather[0].icon}@4x.png" width="120">`;
        
        document.getElementById('v-w').innerText = toFa(Math.round(d.wind.speed * 3.6));
        document.getElementById('v-h').innerText = toFa(d.main.humidity);
        document.getElementById('v-p').innerText = toFa(d.main.pressure);
        document.getElementById('v-v').innerText = toFa((d.visibility/1000).toFixed(1));

        // ØªØ­Ù„ÛŒÙ„ Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø§ØµÙ„Ø§Ø­ Ø´Ø¯Ù‡
        const firstName = localStorage.getItem('ab_name').split(' ')[0];
        const aiMessages = [
            `Ú©Ø§Ø±Ø¨Ø± Ú¯Ø±Ø§Ù…ÛŒ ${firstName}Ø› Ø¨Ø±Ø±Ø³ÛŒâ€ŒÙ‡Ø§ÛŒ Ø¯Ù‚ÛŒÙ‚ Ù‡ÙˆØ§Ø´Ù†Ø§Ø³ÛŒ Ù†Ø´Ø§Ù† Ù…ÛŒâ€ŒØ¯Ù‡Ø¯ Ú©Ù‡ Ø¯Ø± Ø´Ù‡Ø± ${city} Ø¯Ù…Ø§ÛŒ ÙØ¹Ù„ÛŒ Ø­Ø¯ÙˆØ¯ ${toFa(t)} Ø¯Ø±Ø¬Ù‡ Ø³Ø§Ù†ØªÛŒâ€ŒÚ¯Ø±Ø§Ø¯ Ø§Ø³Øª. Ø¨Ø§ ØªÙˆØ¬Ù‡ Ø¨Ù‡ Ù…ÛŒØ²Ø§Ù† Ø±Ø·ÙˆØ¨Øª ${toFa(d.main.humidity)} Ø¯Ø±ØµØ¯ÛŒØŒ Ø´Ø±Ø§ÛŒØ· Ø¬ÙˆÛŒ Ù¾Ø§ÛŒØ¯Ø§Ø±ÛŒ Ø­Ø§Ú©Ù… Ø§Ø³Øª.`,
            `Ø³Ù„Ø§Ù… ${firstName}Ø› Ø³ÛŒØ³ØªÙ… ØªØ­Ù„ÛŒÙ„ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ø§ Ø¨Ø±Ø§ÛŒ ${city}ØŒ ÙØ´Ø§Ø± Ø¬ÙˆÛŒ ${toFa(d.main.pressure)} Ù…ÛŒÙ„ÛŒâ€ŒØ¨Ø§Ø± Ø±Ø§ Ø«Ø¨Øª Ú©Ø±Ø¯Ù‡ Ø§Ø³Øª. ÙˆØ¶Ø¹ÛŒØª ÙØ¹Ù„ÛŒ Ø¢Ø³Ù…Ø§Ù† Ø¨ØµÙˆØ±Øª "${d.weather[0].description}" Ø§Ø±Ø²ÛŒØ§Ø¨ÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯.`,
            `${firstName} Ø¹Ø²ÛŒØ²Ø› Ø¨Ø± Ø§Ø³Ø§Ø³ Ø¢Ø®Ø±ÛŒÙ† Ø¢Ù¾Ø¯ÛŒØª Ø§ÛŒØ³ØªÚ¯Ø§Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ø­Ù„ÛŒ ${city}ØŒ Ø³Ø±Ø¹Øª ÙˆØ²Ø´ Ø¨Ø§Ø¯ ${toFa(Math.round(d.wind.speed * 3.6))} Ú©ÛŒÙ„ÙˆÙ…ØªØ± Ø¨Ø± Ø³Ø§Ø¹Øª Ø§Ø³Øª Ú©Ù‡ Ø¯ÛŒØ¯ Ø§ÙÙ‚ÛŒ Ø±Ø§ Ø¨Ù‡ ${toFa((d.visibility/1000).toFixed(1))} Ú©ÛŒÙ„ÙˆÙ…ØªØ± Ù…ÛŒâ€ŒØ±Ø³Ø§Ù†Ø¯.`
        ];
        document.getElementById('ai-msg').innerText = aiMessages[Math.floor(Math.random() * aiMessages.length)];

        // Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ Ûµ Ø±ÙˆØ²Ù‡ (Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø±ÙˆØ²Ù‡Ø§ÛŒ ØªÚ©Ø±Ø§Ø±ÛŒ)
        const grid = document.getElementById('f-grid'); 
        grid.innerHTML = '';
        const dailyData = f.list.filter(item => item.dt_txt.includes("12:00:00")).slice(0, 5);
        
        dailyData.forEach(day => {
            const date = new Date(day.dt * 1000);
            grid.innerHTML += `
                <div class="f-card">
                    <div style="font-size:0.85rem; margin-bottom:5px">${date.toLocaleDateString('fa-IR', {weekday:'long'})}</div>
                    <img src="https://openweathermap.org/img/wn/${day.weather[0].icon}.png" width="45">
                    <div style="font-weight:bold; color:var(--p)">${toFa(Math.round(day.main.temp))}Â°C</div>
                    <small style="font-size:0.7rem; opacity:0.7">${day.weather[0].description}</small>
                </div>`;
        });
    }

    function saveC() {
        const text = document.getElementById('c-input').value.trim(); 
        if(!text) return;
        const list = JSON.parse(localStorage.getItem('ab_coms') || '[]');
        list.unshift({ u: localStorage.getItem('ab_name'), t: text, d: new Date().toLocaleTimeString('fa-IR') });
        localStorage.setItem('ab_coms', JSON.stringify(list.slice(0, 5)));
        document.getElementById('c-input').value = ''; 
        showC();
    }

    function showC() {
        const list = JSON.parse(localStorage.getItem('ab_coms') || '[]');
        document.getElementById('c-list').innerHTML = list.map(c => `
            <div style="padding:12px; border-bottom:1px solid rgba(128,128,128,0.2); font-size:0.9rem">
                <b style="color:var(--p)">${c.u}:</b> ${c.t} <br>
                <small style="opacity:0.5; font-size:0.7rem">${c.d || ''}</small>
            </div>`).join('');
    }

    window.onload = () => {
        const user = localStorage.getItem('ab_name');
        if(user) {
            document.getElementById('login-overlay').style.display = 'none';
            document.getElementById('h-ui').style.display = 'flex';
            document.getElementById('main-ui').style.display = 'block';
            document.getElementById('u-display').innerText = user;
            Object.keys(DB_FULL).sort().forEach(p => document.getElementById('p-sel').add(new Option(p,p)));
            showC();
        }
        
        setInterval(() => {
            const n = new Date();
            const hour = n.getHours();
            document.body.className = (hour >= 18 || hour < 6) ? 'night-mode' : 'day-mode';
            document.getElementById('m-icon').innerText = (hour >= 18 || hour < 6) ? 'ğŸŒ™' : 'â˜€ï¸';
            document.getElementById('clock').innerText = toFa(n.toLocaleTimeString('fa-IR'));
            document.getElementById('date-fa').innerText = n.toLocaleDateString('fa-IR', {dateStyle:'full'});
        }, 1000);
    };
</script>
</body>
</html>
